@using Prueba.Web.Models
@using Prueba.Web.Services
@inject ClienteService ClienteService
@inject ISnackbar Snackbar


<MudDialog>
    <DialogContent>
    <MudForm @ref="form" Model="Cliente" Validated="OnValidSubmit">
        <MudTextField @bind-Value="Cliente.Nombre" Label="Nombre" Required="true" />
        <MudTextField @bind-Value="Cliente.Identidad" Label="Identidad" Required="true" />

        
    </MudForm>
    </DialogContent>
    <DialogActions>
            <MudButton Color="Color.Primary" OnClick="Guardar">Guardar</MudButton>
            <MudButton Color="Color.Secondary" OnClick="Cancelar">Cancelar</MudButton>
        </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = default!;
    [Parameter] public ClienteModel Cliente { get; set; } = new();
    private MudForm? form;

    private async Task Guardar()
    {
        if (form is not null)
        {
            await form.Validate();

            if (form.IsValid)
            {
                bool result;
                if (Cliente.ClienteId == 0)
                    result = await ClienteService.CreateAsync(Cliente);
                else
                    result = await ClienteService.UpdateAsync(Cliente);

                if (result)
                    MudDialog.Close(DialogResult.Ok(Cliente));
                else
                    MudDialog.Close(DialogResult.Ok(Cliente));
                  //  Snackbar.Add("Error al guardar el cliente", Severity.Error);
            }
        }
    }

    private void Cancelar()
    {
        MudDialog.Cancel();
    }
}

